{
   "_id": "_design/crossref",
   "_rev": "10-e2c5b9e62e8aba0f2741d2a1e6458f7c",
   "language": "javascript",
   "lists": {
       "n-triples": "function(head,req) { var headers = ''; var row; start({ 'headers': { 'Content-Type': 'text/plain' } }); while(row = getRow()) { send(row.value); } }"
   },
   "views": {
       "nt": {
           "map": "/*\n\nShared code\n\n\n*/\n//----------------------------------------------------------------------------------------\n// Store a triple with optional language code\nfunction triple(subject, predicate, object, language) {\n  var triple = [];\n  triple[0] = subject;\n  triple[1] = predicate;\n  triple[2] = object;\n\n  if (typeof language === 'undefined') {} else {\n    triple[3] = language;\n  }\n\n  return triple;\n}\n\n//----------------------------------------------------------------------------------------\n// Store a quad (not used at present)\nfunction quad(subject, predicate, object, context) {\n  var triple = [];\n  triple[0] = $subject;\n  triple[1] = $predicate;\n  triple[2] = $object;\n  triple[3] = $context;\n\n  return triple;\n}\n\n//----------------------------------------------------------------------------------------\n// Enclose triple in suitable wrapping for HTML display or triplet output\nfunction wrap(s, html) {\n  if (s.match(/^(http|urn|_:)/)) {\n    s = s.replace(/\\\\_/g, '_');\n\n    // handle < > in URIs such as SICI-based DOIs\n    s = s.replace(/</g, '%3C');\n    s = s.replace(/>/g, '%3E');\n\n   if (html) {\n      s = '&lt;' + s + '&gt;';\n    } else {\n      s = '<' + s + '>';\n    }\n  } else {\n    s = '\"' + s.replace(/\"/g, '\\\\\"') + '\"';\n  }\n  return s;\n}\n\n//----------------------------------------------------------------------------------------\n// https://css-tricks.com/snippets/javascript/htmlentities-for-javascript/\nfunction htmlEntities(str) {\n  return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n}\n\n//----------------------------------------------------------------------------------------\nfunction output(doc, triples) {\n    // CouchDB\n    for (var i in triples) {\n      var s = 0;\n      var p = 1;\n      var o = 2;\n\n      var lang = 3;\n\n      var nquads = wrap(triples[i][s], false) \n\t    \t+ ' ' + wrap(triples[i][p], false) \n\t    \t+ ' ' + wrap(triples[i][o], false);\n\t    if (triples[i][lang]) {\n\t    \tnquads += '@' + triples[i][lang];\n\t    }\n\t    \t\n\t    nquads += ' .' + \"\\n\";\n\n\n      emit(doc._id, nquads);\n    }\n}\n\n//----------------------------------------------------------------------------------------\nfunction  detect_language(s) {\n  var language = null;\n  var matched = 0;\n  var parts =[];\n  \n  var regexp = [];\n  \n  // https://gist.github.com/ryanmcgrath/982242\n  regexp['ja'] = /[\\u3000-\\u303F]|[\\u3040-\\u309F]|[\\u30A0-\\u30FF]|[\\uFF00-\\uFFEF]|[\\u4E00-\\u9FAF]|[\\u2605-\\u2606]|[\\u2190-\\u2195]|\\u203B/g; \n  // http://hjzhao.blogspot.co.uk/2015/09/javascript-detect-chinese-character.html\n  regexp['zh'] = /[\\u4E00-\\uFA29]/g; \n  // http://stackoverflow.com/questions/32709687/js-check-if-string-contains-only-cyrillic-symbols-and-spaces\n  regexp['ru'] = /[\\u0400-\\u04FF]/g; \n  \n  for (var i in regexp) {\n    parts = s.match(regexp[i]);\n    \n\t  if (parts != null) {\n\t\tif (parts.length > matched) {\n\t\t  language = i;\n\t\t  matched = parts.length;\n\t\t}\n\t  }\n  }\n  \n  // require a minimum matching\n  if (matched < 10) {\n    language = null;\n  }\n  \n  return language;\n  \n}\n\n\nfunction message(doc) {\n  if (doc.message) {\n\n   var subject_id = doc._id.toLowerCase();   \n   subject_id = subject_id.replace(/http[s]?:\\/\\/(dx\\.)?doi.org\\//, 'http://identifiers.org/doi/');\n \n  var triples = [];\n    var type = '';\n\n    for (var i in doc.message) {\n      switch (i) {\n\n        case 'DOI':\n          triples.push(triple(subject_id,\n            'http://schema.org/identifier',\n            'http://identifiers.org/doi/' + doc.message[i].toLowerCase()));\n          break;\n\n        case 'URL':\n          triples.push(triple(subject_id,\n            'http://schema.org/url',\n            doc.message[i]));\n          break;\n          \n        case 'alternative-id':\n\t\t\tfor (var j in doc.message[i]) {\n\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t'http://schema.org/identifier',\n\t\t\t\tdoc.message[i][j]));\n\t\t\t}\n\t\t\tbreak;      \n\t\t\t\n\t\tcase 'type':\n\t\t\tswitch (doc.message[i]) {\n\t\t\t  case 'article-journal':\n\t\t\t  case 'journal-article':\n\t\t\t    type = 'http://schema.org/ScholarlyArticle';\n\t\t\t\tbreak;\n\t\t\t  default:\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\t\t  \n\n          // title can be string or array\n        case 'title':\n          if (Array.isArray(doc.message[i])) {\n            for (var j in doc.message[i]) {\n\n              var lang = detect_language(doc.message[i][j]);\n\n              triples.push(triple(subject_id,\n                'http://schema.org/name',\n                doc.message[i][j], lang));\n            }\n          } else {\n            triples.push(triple(subject_id,\n              'http://schema.org/name',\n              doc.message[i]));\n          }\n          break;\n          \n\n\t\t\t// article metadata\n\t\t  case 'issue':\n\t\t\ttriples.push(triple(subject_id,\n\t\t\t  'http://schema.org/issueNumber',\n\t\t\t  doc.message[i]));\n\t\t\tbreak;\n\n\t\t  case 'pages':\n\t\t\ttriples.push(triple(subject_id,\n\t\t\t  'http://schema.org/pagination',\n\t\t\t  doc.message[i]));\n\t\t\tbreak;\n\n\t\t  case 'volume':\n\t\t\ttriples.push(triple(subject_id,\n\t\t\t  'http://schema.org/volumeNumber',\n\t\t\t  doc.message[i]));\n\t\t\tbreak;\n\t\t\n\t\t  case 'page':\n\t\t\tvar parts = doc.message[i].match(/^(.*)\\-(.*)$/);\n\t\t\tif (parts) {\n\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t'http://schema.org/pageStart',\n\t\t\t\tparts[1]));\n\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t'http://schema.org/pageEnd',\n\t\t\t\tparts[2]));\n\t\t\t} else {\n\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t'http://schema.org/pagination',\n\t\t\t\tdoc.message[i]));\n\t\t\t}\n\t\t\tbreak;\n\t\t\n\t  case 'issued':\n\t     var date = '';\n\t     var dateparts = doc.message[i]['date-parts'][0];\n\t     \n\t     switch (dateparts.length) {\n\t        case 1:\n\t           date = dateparts[0];\n\t           break;\n\t        case 2:\n\t           date = dateparts[0] + '-' + (\"00\" + dateparts[1]).slice(-2) + '-00';\n\t           break;\n\t        case 3:\n\t           date = dateparts[0] + '-' + (\"00\" + dateparts[1]).slice(-2) + '-' + (\"00\" + dateparts[2]).slice(-2);\t           \n\t           break;\n\t        default:\n\t        \tbreak;\n\t    }\n\t    triples.push(triple(subject_id,\n          'http://schema.org/datePublished',\n          date.toString()));\n\t    \n\t    break;\n          \n          \n\t\t\t// tags\n\t\t  case 'subject':\n\t\t\tfor (var j in doc.message[i]) {\n\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t'http://schema.org/keywords',\n\t\t\t\tdoc.message[i][j]));\n\t\t\t}\n\t\t\tbreak;\n\t\t\t\n\t\t\t// license\n\t\t  case 'license':\n\t\t\tfor (var j in doc.message[i]) {\n\t\t\t  if (doc.message[i][j].URL) {\n\t\t\t\ttriples.push(triple(subject_id,\n\t\t\t\t  'http://schema.org/license',\n\t\t\t\t  doc.message[i][j].URL));\n\t\t\t  }\n\t\t\t}\n\t\t\tbreak;\n\t\t\t\n\t\t\t// publisher\n\t\t\t// should this be linked to journal rather than article?\n\t\t\t// should this be an object rather than a string?\n\t\t  case 'publisher':\n\t\t\ttriples.push(triple(subject_id,\n\t\t\t  'http://schema.org/publisher',\n\t\t\t  doc.message[i]));\n\t\t\tbreak;\n\t\t\t\t\t\t\n\t\t\n\t\t\t// abstract\n\t\t  case 'abstract':\n\t\t\ttriples.push(triple(subject_id,\n\t\t\t\t  'http://schema.org/description',\n\t\t\t\t  doc.message[i]));\n\t\t\tbreak;\n          \n          \n\t\t  // work level multi\n\t\t  // do this because there may be fields that only exist in multi keys\n\t\t  case 'multi':\n\t\t\tfor (var j in doc.message['multi']._key) {\n\t\t\t  for (var k in doc.message['multi']._key[j]) {\n\t\t\t\tswitch (j) {\n\t\t\t\t  case 'title':\n\t\t\t\t\ttriples.push(triple(subject_id,\n\t\t\t\t\t\t'http://schema.org/name',\n\t\t\t\t\t\tdoc.message['multi']._key[j][k], k));\n\t\t\t\t\tbreak;\n\t\t\t\t  case 'abstract':\n\t\t\t\t\ttriples.push(triple(subject_id,\n\t\t\t\t\t\t'http://schema.org/description',\n\t\t\t\t\t\tdoc.message['multi']._key[j][k], k));\n\t\t\t\t\tbreak;\n\t\t\t\t   default:\n\t\t\t\t\t break;\n\t\t\t\t  }\n\t\t\t\t}\n\t\t\t}               \n\t\t\tbreak; \n\t\t\t\n\t\t\t// journal\n\t\t  case 'container-title':\n\t\t\t  // journal name can be string or array\n\t\t\t  if (Array.isArray(doc.message['container-title'])) {\n\t\t\t\tfor (var j in doc.message['container-title']) {\n\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t'http://prismstandard.org/namespaces/basic/2.1/publicationName',\n\t\t\t\t\tdoc.message['container-title'][j]));\n\t\t\t\t}\n\t\t\t  } else {\n\t\t\t\ttriples.push(triple(subject_id,\n\t\t\t\t  'http://prismstandard.org/namespaces/basic/2.1/publicationName',\n\t\t\t\t  doc.message['container-title']));\n\t\t\t  }\t\t  \n\t\t    break;\n\n\t\t  case 'ISSN':\n\t\t\t// one journal, but can have 1-2 ISSNs\n\t\t\t// pick one for cluster_id\n\t\t\t var journal_id = 'http://www.worldcat.org/issn/' + doc.message[i][0];\n\t\t \n\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t'http://schema.org/isPartOf',\n\t\t\t\tjournal_id\n\t\t\t  ));\n\t\t \n\t\t\t  // type\n\t\t\t  triples.push(triple(journal_id,\n\t\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t'http://schema.org/Periodical'));\n\n\t\t\t  // journal name can be string or array\n\t\t\t  if (Array.isArray(doc.message['container-title'])) {\n\t\t\t\tfor (var j in doc.message['container-title']) {\n\t\t\t\t  triples.push(triple(journal_id,\n\t\t\t\t\t'http://schema.org/name',\n\t\t\t\t\tdoc.message['container-title'][j]));\n\t\t\t\t}\n\t\t\t  } else {\n\t\t\t\ttriples.push(triple(journal_id,\n\t\t\t\t  'http://schema.org/name',\n\t\t\t\t  doc.message['container-title']));\n\t\t\t  }\n\t\t  \n\t\t\t\t// multi?\n\t\t\t\tif (doc.message['multi']) {\n\t\t\t\t  if (doc.message['multi']._key['container-title']) {\n\t\t\t\t\tfor (var j in doc.message['multi']._key['container-title']) {\n\t\t\t\t\t  triples.push(triple(journal_id,\n\t\t\t\t\t\t'http://schema.org/name',\n\t\t\t\t\t\tdoc.message['multi']._key['container-title'][j], j));  \n\t\t\t\t\t}\n\t\t\t\t  }\n\t\t\t\t} \n\t\t  \n\t\t  \n\t\t\t  // ISSNs\n\t\t\tfor (var j in doc.message[i]) {\n\n\t\t\t  // issn\n\t\t\t  triples.push(triple(journal_id,\n\t\t\t\t'http://schema.org/issn',\n\t\t\t\tdoc.message[i][j]));\n\t\t\t\n\t\t\t  // identifiers\n\t\t\ttriples.push(triple(journal_id,\n\t\t\t  'http://schema.org/identifier',\n\t\t\t  'http://www.worldcat.org/issn/' + doc.message[i][j]));\n\t\t  \n\t\t  \n\n\t\t\t}\n\t\t\tbreak;\n\t\t\t\n\t\t\t// authors (may include ORCIDs)\n\t\t\t// create an identifier to make this addressable\n\t\t  case 'author':\n\t\t\tvar n = doc.message[i].length;\n\t\t\t\n\t\t\t// store an ordered list of authors as well\n\t\t\t\n\t\t\t//http://purl.org/ontology/bibo/contributorList\n\t\t\t\n\t\t\t\n\t\t\tfor (var j = 0; j < n; j++) {\n\t\t\t  var author_id = '';\n\n\t\t\t  // create identifier\n\t\t\t  if (1) {\n\t\t\t     // use ORCID if available, otherwise hash\n\t\t\t  \tif (doc.message[i][j].ORCID) {\n\t\t\t\t\tauthor_id = doc.message[i][j].ORCID;\n\t\t\t  \t} else {\n\t\t\t\t\t// #hash identifier \n\t\t\t\t\tauthor_id = subject_id + '#author_' + (j + 1);\n\t\t\t  \t}\n\t\t\t  } else {\n\t\t\t \t // always use #hash identifier \n\t\t\t   \tauthor_id = subject_id + '#author_' + (j + 1);\n\t\t\t  }\n\n\t\t\t  // type, need to handle organisations as authors\n\t\t\t  triples.push(triple(author_id,\n\t\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t'http://schema.org/Person'));\n\n\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t'http://schema.org/author',\n\t\t\t\tauthor_id));\n\n\t\t\t  // name\n\t\t\t  var name = '';\n\t\t\t  if (doc.message[i][j].given) {\n\t\t\t\ttriples.push(triple(author_id,\n\t\t\t\t  'http://schema.org/givenName', // ?\n\t\t\t\t  doc.message[i][j].given));\n\n\t\t\t\tname += doc.message[i][j].given;\n\t\t\t  }\n\t\t\t  if (doc.message[i][j].family) {\n\t\t\t\ttriples.push(triple(author_id,\n\t\t\t\t  'http://schema.org/familyName', // ?\n\t\t\t\t  doc.message[i][j].family));\n\n\t\t\t\tname += ' ' + doc.message[i][j].family;\n\t\t\t  }\n\n\t\t\t  if (name != '') {\n\t\t\t\ttriples.push(triple(author_id,\n\t\t\t\t  'http://schema.org/name', // ?\n\t\t\t\t  name));\n\t\t\t  }\n\t\t\t  \n\t\t\t  // identifier\n\t\t\t  if (doc.message[i][j].ORCID) {\n\t\t\t    triples.push(triple(author_id,\n\t\t\t\t  'http://schema.org/identifier',\n\t\t\t\t  doc.message[i][j].ORCID));\n\t\t\t\t\n\t\t\t  }\n\t\t  \n\t\t\t  // affiliation\n\t\t\t  // make into a role\n\t\t\t if (doc.message[i][j].affiliation) {     \n\t\t\t\tvar affiliation_count = 1;       \n\t\t\t\tfor (var k in doc.message[i][j].affiliation) {\n\t\t\t\t   if (doc.message[i][j].affiliation[k].name) {\n\t\t\t\t\t var affiliation_id = author_id + '/affiliation_' + affiliation_count;\n\t\t\t\t\t var affiliation_role_id = author_id + '/affiliation_' + affiliation_count + '/role';\n\t\t\t   \n\t\t\t\t\t // author to role\n\t\t\t\t\t triples.push(triple(author_id,\n\t\t\t\t\t  'http://schema.org/affiliation', \n\t\t\t\t\t  affiliation_role_id));\n\t\t\t\t  \n\t\t\t\t\t triples.push(triple(affiliation_role_id,\n\t\t\t\t\t   'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t\t\t'http://schema.org/OrganizationRole'));\n\t\t\t\t\t\n\t\t\t\t\t // role to affiliation\n\t\t\t\t\t triples.push(triple(affiliation_role_id,\n\t\t\t\t\t  'http://schema.org/affiliation', \n\t\t\t\t\t  affiliation_id));\n\t\t\t\t \n\t\t\t\t\t triples.push(triple(affiliation_id,\n\t\t\t\t\t  'http://schema.org/name', \n\t\t\t\t\t  doc.message[i][j].affiliation[k].name));\n \n\t\t\t\t\t triples.push(triple(affiliation_id,\n\t\t\t\t\t   'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t\t  'http://schema.org/Organisation'));\n \n\t\t\t\t   }\n\t\t\t\t   affiliation_count++;\n\t\t\t\t }\n\t\t\t  }\n\t\t \n\n\t\t\t}\n\t\t\tbreak;\t\t\t\n\t\t\t\n          \n\t\t\t// funding\n\t\t  case 'funder':\n\t\t\tvar n = doc.message[i].length;\n\t\t\tfor (var j = 0; j < n; j++) {\n\t\t\t  var funder_id = '';\n\n\t\t\t  // create identifier for funder\n\t\t\t  if (doc.message[i][j].DOI) {\n\t\t\t\tfunder_id = 'http://identifiers.org/doi/' + doc.message[i][j].DOI;\n\t\t\t  } else {\n\t\t\t\t// #hash identifier \n\t\t\t\tfunder_id = subject_id + '#funder_' + (j + 1);\n\t\t\t  }\n\n\t\t\t  // create funder \n\t\t\t  triples.push(triple(funder_id,\n\t\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t'http://schema.org/Organisation'));\n\n\t\t\t  triples.push(triple(funder_id,\n\t\t\t\t'http://schema.org/name',\n\t\t\t\tdoc.message[i][j].name));\n\n\t\t\t  // role\n\t\t\t  var m = doc.message[i][j].award.length;\n\n\t\t\t  if (m == 0) {\n\t\t\t\t// funder but award not known\n\t\t\t\tvar award_id = funder_id + '/award';\n\n\t\t\t\ttriples.push(triple(award_id,\n\t\t\t\t  'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t  'http://schema.org/Role'));\n\n\t\t\t\t// link to funder \n\t\t\t\ttriples.push(triple(award_id,\n\t\t\t\t  'http://schema.org/funder',\n\t\t\t\t  funder_id));\n\n\t\t\t\t// link role to work         \n\t\t\t\ttriples.push(triple(subject_id,\n\t\t\t\t  'http://schema.org/funder',\n\t\t\t\t  award_id));\n\t\t\t  } else {\n\t\t\t\t// we have one or more awards\n\t\t\t\tfor (var a = 0; a < m; a++) {\n\t\t\t\t  var award_id = funder_id + '/award_' + (a+1);\n\n\t\t\t\t  triples.push(triple(award_id,\n\t\t\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t\t'http://schema.org/Role'));\n\n\t\t\t\t  triples.push(triple(award_id,\n\t\t\t\t\t'http://schema.org/roleName',\n\t\t\t\t\tdoc.message[i][j].award[a]\n\t\t\t\t  ));\n\n\t\t\t\t  // link to funder \n\t\t\t\t  triples.push(triple(award_id,\n\t\t\t\t\t'http://schema.org/funder',\n\t\t\t\t\tfunder_id));\n\n\t\t\t\t  // link role to work         \n\t\t\t\t  triples.push(triple(subject_id,\n\t\t\t\t\t'http://schema.org/funder',\n\t\t\t\t\taward_id));\n\t\t\t\t}\n\t\t\t  }\n\t\t\t}\n\t\t\tbreak;\n\t\t\t\n\n\t\t\t// links to representions such as PDFs, XML, HTML, etc.\n\t\t\t// may be links to text mining sources\n\t\t  case 'link':\n\t\t\tvar n = doc.message[i].length;\n\t\t\tfor (var j = 0; j < n; j++) {\n\t\t\t  var link_id = subject_id + '#link_' + (j + 1);\n\n\t\t\t  // type\n\t\t\t  triples.push(triple(link_id,\n\t\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t'http://schema.org/CreativeWork'));\n\n\t\t\t  if (doc.message[i][j].URL) {\n\t\t\t\ttriples.push(triple(link_id,\n\t\t\t\t  'http://schema.org/url',\n\t\t\t\t  doc.message[i][j].URL));\n\n\t\t\t\tif (doc.message[i][j]['content-type']) {\n\t\t\t\t  triples.push(triple(link_id,\n\t\t\t\t\t'http://schema.org/fileFormat',\n\t\t\t\t\tdoc.message[i][j]['content-type']));\n\t\t\t\t}\n\n\t\t\t\t// link to work\n\t\t\t\ttriples.push(triple(subject_id,\n\t\t\t\t  'http://schema.org/workExample',\n\t\t\t\t  link_id));\n\t\t\t  }\n\t\t\t}\n\t\t\tbreak;\n\n\n/*\n      \"reference\": [\n           {\n               \"key\": \"11192_B1\",\n               \"first-page\": \"119\",\n               \"article-title\": \"Pseudocrangonyx, a new genus of subterranean amphipods from Japan.\",\n               \"volume\": \"10\",\n               \"author\": \"Akatsuka\",\n               \"year\": \"1922\",\n               \"journal-title\": \"Annotationes Zoologicae Japonenses\"\n           },\n */\n \t\t  case 'reference':\n\t\t\tvar n = doc.message[i].length;\n\t\t\tfor (var j = 0; j < n; j++) {\n\t\t\t  var reference_id = subject_id + '#' + doc.message[i][j].key;\n\t\t\t  \n \t\t\t\t// link to work\n\t\t\t\ttriples.push(triple(subject_id,\n\t\t\t\t  'http://schema.org/citation',\n\t\t\t\t  reference_id));\n\t\t\t  \n\t\t\t  // type\n\t\t\t  triples.push(triple(reference_id,\n\t\t\t\t'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n\t\t\t\t'http://schema.org/CreativeWork'));\n\n\t\t\t  // default identifier\n\t\t\t  triples.push(triple(reference_id,\n\t\t\t\t'http://schema.org/identifier',\n\t\t\t\treference_id));\n\n               // DOI?\n               if (doc.message[i][j].DOI) {\n\t\t\t\t  triples.push(triple(reference_id,\n\t\t\t\t\t'http://schema.org/identifier',\n\t\t\t\t\t'http://identifiers.org/doi/' + doc.message[i][j].DOI));\n\t\t\t\t\t\n\t\t\t\t  // for ease of querying\n                  triples.push(triple(reference_id,\n\t\t\t\t\t'http://prismstandard.org/namespaces/basic/2.1/doi',\n\t\t\t\t\tdoc.message[i][j].DOI));\t\t\t\t  \t\t\t\t\t\t\n\t\t\t\t}  \n\t\t\t\t\n\t\t\t\t// unstructured?\n                if (doc.message[i][j].unstructured) {\n\t\t\t\t  triples.push(triple(reference_id,\n\t\t\t\t\t'http://schema.org/description',\n\t\t\t\t\tdoc.message[i][j].unstructured));\n\t\t\t\t}               \n\t\t\t\t\n\t\t\t\t// metadata\n\t\t\t\t\n\t\t\t\t/* *** non schema *** */\n               if (doc.message[i][j].author) {\n\t\t\t\t  triples.push(triple(reference_id,\n\t\t\t\t\t'http://purl.org/dc/terms/creator',\n\t\t\t\t\tdoc.message[i][j].author));\n\t\t\t\t}               \n\t\t\t\t\n\t\t\t\t\n               if (doc.message[i][j]['article-title']) {\n\t\t\t\t  triples.push(triple(reference_id,\n\t\t\t\t\t'http://schema.org/name',\n\t\t\t\t\tdoc.message[i][j]['article-title']));\n\t\t\t\t}               \n\t\t\t\t\n\t\t\t\t/* *** non schema *** */\n               if (doc.message[i][j]['journal-title']) {\n\t\t\t\t  triples.push(triple(reference_id,\n\t\t\t\t\t'http://prismstandard.org/namespaces/basic/2.1/publicationName',\n\t\t\t\t\tdoc.message[i][j]['journal-title']));\n\t\t\t\t}  \n                if (doc.message[i][j].volume) {\n\t\t\t\t  triples.push(triple(reference_id,\n\t\t\t\t\t'http://schema.org/volumeNumber',\n\t\t\t\t\tdoc.message[i][j].volume));\n\t\t\t\t}               \t\t\t\t             \n               if (doc.message[i][j]['first-page']) {\n\t\t\t\t  triples.push(triple(reference_id,\n\t\t\t\t\t'http://schema.org/pageStart',\n\t\t\t\t\tdoc.message[i][j]['first-page']));\n\t\t\t\t}               \n               if (doc.message[i][j].year) {\n\t\t\t\t  triples.push(triple(reference_id,\n\t\t\t\t\t'http://schema.org/datePublished',\n\t\t\t\t\tdoc.message[i][j].year));\n\t\t\t\t}               \n\t\t\t\t             \n\t\t\t  }\n\t\t\t\n\t\t\tbreak;\n  \n\t\t\t\n\n        default:\n          break;\n      }\n    }\n\n    if (type == '') {\n      type = 'http://schema.org/CreativeWork';\n    }\n    \n\n    // defaults\n    triples.push(triple(subject_id,\n      'http://www.w3.org/1999/02/22-rdf-syntax-ns#type',\n      type));\n\n    output(doc, triples);\n  }\n}\n\nfunction(doc) {\n  if (doc['message-format']) {\n    if (doc['message-format'] == 'application/vnd.crossref-api-message+json') {\n      message(doc);\n    }\n  }\n}"
       },
       "modified": {
           "map": "function(doc) {\n  if (doc['message-format']) {\n    if (doc['message-format'] == 'application/vnd.crossref-api-message+json') {\n     if (doc.message) {\n      emit(doc['message-modified'], doc._id);\n     }\n    }\n  }\n}"
       }
   }
}